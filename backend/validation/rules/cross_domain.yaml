# Cross-domain validation rules (SEND-VAL-007 through SEND-VAL-010)
# These rules check consistency and referential integrity across multiple domains.

rules:
  - id: "SEND-VAL-007"
    core_ref: null
    name: "USUBJID referential integrity"
    description: "Checks that every USUBJID value in findings, interventions, and events domains exists in the Demographics (DM) domain. Detects orphan records that reference subjects not defined in DM."
    severity: "Error"
    category: "Referential integrity"
    applicable_domains: ["ALL"]
    check_type: "usubjid_integrity"
    parameters: {}
    fix_guidance: "Add missing subjects to DM or remove orphan records"
    auto_fixable: false
    default_fix_tier: 3
    evidence_type: "metadata"
    cdisc_reference: "SENDIG 3.1, Section 4.1"

  - id: "SEND-VAL-008"
    core_ref: null
    name: "STUDYID consistency across domains"
    description: "Validates that the STUDYID variable contains the same value across all domains in the study dataset. Detects domains where STUDYID differs from the value in DM or TS."
    severity: "Error"
    category: "Referential integrity"
    applicable_domains: ["ALL"]
    check_type: "studyid_consistency"
    parameters: {}
    fix_guidance: "Ensure STUDYID is identical across all domains"
    auto_fixable: false
    default_fix_tier: 2
    evidence_type: "value-correction"
    cdisc_reference: "SENDIG 3.1, Section 2.1"

  - id: "SEND-VAL-009"
    core_ref: null
    name: "Baseline flag consistency"
    description: "Checks that each subject has exactly one baseline record per test code in domains that use baseline flags (--BLFL). Validates that baseline records have a study day less than or equal to zero."
    severity: "Warning"
    category: "Data integrity"
    applicable_domains: ["LB", "BW", "CL", "EG", "FW", "OM", "VS"]
    check_type: "baseline_consistency"
    parameters: {}
    fix_guidance: "Ensure one baseline record per subject per test code, with study day <= 0"
    auto_fixable: false
    default_fix_tier: 2
    evidence_type: "metadata"
    cdisc_reference: "SENDIG 3.1, Section 6"

  - id: "SEND-VAL-010"
    core_ref: null
    name: "SUPP-- domain referential integrity"
    description: "Validates that supplemental qualifier domains (SUPP--) have matching records in their parent domain. Checks that USUBJID and IDVAR/IDVARVAL combinations in SUPP-- datasets reference existing records in the parent domain."
    severity: "Error"
    category: "Referential integrity"
    applicable_domains: ["ALL"]
    check_type: "supp_integrity"
    parameters: {}
    fix_guidance: "Ensure SUPP-- USUBJID values exist in parent domain"
    auto_fixable: false
    default_fix_tier: 3
    evidence_type: "metadata"
    cdisc_reference: "SENDIG 3.1, Section 8.4"

  # ── Phase 2 rules ──────────────────────────────────────────────────────

  - id: "SEND-VAL-014"
    name: "Duplicate record detection"
    description: "Detects duplicate records based on same USUBJID + sequence number (--SEQ) within a domain."
    severity: "Error"
    category: "Data integrity"
    applicable_domains: ["ALL"]
    check_type: "duplicate_detection"
    parameters: {}
    fix_guidance: "Remove duplicate records or assign unique --SEQ values"
    auto_fixable: false
    default_fix_tier: 3
    evidence_type: "metadata"
    cdisc_reference: "SENDIG 3.1"

  - id: "SEND-VAL-015"
    name: "Value range checks"
    description: "Checks for impossible values: body weight <= 0, negative organ weights, and other out-of-range numeric values."
    severity: "Warning"
    category: "Data integrity"
    applicable_domains: ["BW", "OM"]
    check_type: "value_ranges"
    parameters: {}
    fix_guidance: "Verify source data for flagged values. If correct, accept as-is."
    auto_fixable: false
    default_fix_tier: 1
    evidence_type: "range-check"
    cdisc_reference: "SENDIG 3.1"

  - id: "SEND-VAL-017"
    name: "Exposure domain validation"
    description: "EX-specific checks: EXDOSE numeric and >= 0, EXDOSU consistent across all records."
    severity: "Warning"
    category: "Data integrity"
    applicable_domains: ["EX"]
    check_type: "exposure_validation"
    parameters: {}
    fix_guidance: "Review exposure records for data entry errors"
    auto_fixable: false
    default_fix_tier: 1
    evidence_type: "range-check"
    cdisc_reference: "SENDIG 3.1, Section 4.3"
